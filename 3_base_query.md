# Курс «Симулятор SQL»

## 3 урок Базовые запросы SQL

### Практика

#### [Задача 1](https://lab.karpov.courses/learning/152/module/1762/lesson/18484/53190/250919)

<details>

Первые лекции позади, пора приступать к практике!

Давайте для начала напишем самый простой запрос и посмотрим, как выглядит таблица `products`.

Чтобы вывести все записи со значениями во всех колонках, необходимо либо перечислить все колонки в операторе `SELECT`, либо указать после оператора специальный символ «*»:

```sql
SELECT column_1, column_2, ...
FROM table


SELECT *
FROM table
```

`На заметку:`

Оператор `FROM` всегда указывается после оператора `SELECT`. В обратном порядке их записывать нельзя — база данных вернёт ошибку.

</details>
       
`Задание:`

Выведите все записи из таблицы `products`.

Поля в результирующей таблице: `product_id, name, price`


```sql

SELECT *
FROM   products

```

#### [Задача 2](https://lab.karpov.courses/learning/152/module/1762/lesson/18484/53190/250920)

<details>
       
Для сортировки значений по какой-либо колонке в SQL используется оператор `ORDER BY` с ключевыми словами `ASC` (по возрастанию) или `DESC` (по убыванию).

При этом по умолчанию сортировка происходит по возрастанию, т.е. ASC указывать не обязательно. Для сортировки по убыванию после `ORDER BY` необходимо явно указать DESC:

```sql
SELECT column_1, column_2
FROM table
ORDER BY column_1        -- сортировка по возрастанию


SELECT column_1, column_2
FROM table
ORDER BY column_1 ASC    -- сортировка по возрастанию


SELECT column_1, column_2
FROM table
ORDER BY column_1 DESC   -- сортировка по убыванию
```

`На заметку:`

Оператор ORDER BY всегда указывается после операторов `SELECT` и `FROM`.

</details>

`Задание:`

Выведите все записи из таблицы `products`, отсортировав их по наименованиям товаров в алфавитном порядке, т.е. по возрастанию. Для сортировки используйте оператор `ORDER BY`.

Поля в результирующей таблице: `product_id, name, price`

`Пояснение:`

Сортировку можно делать не только по полям со значениями, выраженными числами, но и по полям, значения в которых представлены в виде текста, как в нашем случае.

```sql

SELECT *
FROM   products
ORDER BY name asc

```

#### [Задача 3](https://lab.karpov.courses/learning/152/module/1762/lesson/18484/53190/250921)

<details>
Сортировать результат SQL-запроса можно сразу по нескольким колонкам, указывая их после `ORDER BY` через запятую вместе с направлением сортировки (`ASC` или `DESC`):

```sql
SELECT column_1, column_2
FROM table
ORDER BY column_1 DESC, column_2    -- сначала сортировка по первой колонке (по убыванию), 
                                    -- затем по второй (по возрастанию)
```

Для ограничения числа извлекаемых из таблицы записей применяется оператор `LIMIT`.

Записывается он так:

```sql
SELECT column
FROM table
LIMIT n 
```

На месте `n` может быть любое целое число — ровно столько записей, сколько вам необходимо. Например, 100:

```sql
SELECT column
FROM table
LIMIT 100
```

Если `n` превысит количество записей в таблице, то в результат попадут все записи.

`На заметку:`

Важно помнить, что при работе с большими таблицами нужно по возможности ограничивать число извлекаемых записей, чтобы не создавать лишнюю нагрузку на базу данных.

Разумеется, операторы `ORDER BY` и `LIMIT` можно совмещать в одном запросе, при этом оператор `LIMIT` записывается и выполняется после оператора `ORDER BY`, ограничивая число записей в уже отсортированном результате:

```sql
SELECT column_1, column_2
FROM table
ORDER BY column_1 DESC, column_2
LIMIT 100
```

</details>

`Задание:`

Отсортируйте таблицу `courier_actions` сначала по колонке `courier_id` по возрастанию `id` курьера, потом по колонке `action` (снова по возрастанию), а затем по колонке `time`, но уже по убыванию — от самого последнего действия к самому первому. Не забудьте включить в результат колонку `order_id`.

Добавьте в запрос оператор `LIMIT` и выведите только первые 1000 строк результирующей таблицы.

Поля в результирующей таблице: `courier_id, order_id, action, time`

`Пояснение:`

Как вы уже догадались, сортировать таблицы можно в том числе по полям с датами и временем.

```sql

SELECT *
FROM   courier_actions
ORDER BY courier_id asc, action asc, time desc limit 1000

```

#### [Задача 4](https://lab.karpov.courses/learning/152/module/1762/lesson/18484/53190/250922)

<details>
Вот мы и разобрались, как работают операторы ORDER BY и LIMIT.

Сейчас важно запомнить порядок записи всех известных нам ключевых слов:

`SELECT`
`FROM`
`ORDER BY`
`LIMIT`
Также важно понять, что порядок их выполнения несколько отличается от того, в какой последовательности они указываются в SQL-запросе:

Сначала выполняется оператор `FROM` — происходит выбор нужной таблицы.
Затем `SELECT` — отбираются указанные столбцы.
Потом `ORDER BY` — производится сортировка результирующей таблицы.
И в самом конце `LIMIT` — ограничивается количество выводимых записей.
Подробнее о порядке выполнения операторов мы будем ещё не раз говорить в последующих уроках. 

А сейчас давайте попробуем с помощью всех этих знаний решить несложную практическую задачу.

</details>

`Задание:`

Используя операторы `SELECT, FROM, ORDER BY и LIMIT`, определите 5 самых дорогих товаров в таблице `products`, которые доставляет наш сервис. Выведите их наименования и цену.

Поля в результирующей таблице: `name, price`

```sql

SELECT name,
       price
FROM   products
ORDER BY price desc limit 5

```

#### [Задача 5](https://lab.karpov.courses/learning/152/module/1762/lesson/18484/53190/250923)

<details>
При составлении SQL-запросов колонкам в результирующей таблице можно присваивать любые другие имена (их ещё называют «алиасами»). Это можно делать с помощью оператора AS:

```sql
SELECT name AS new_name
FROM table
```

Если вдруг вам покажется, что на написание оператора AS уходит слишком много времени и сил, то его можно опустить, указав новое имя колонки без него. Следующая запись тоже сработает:

```sql
SELECT name new_name
FROM table
```
</details>

`Задание:`

Как в прошлом задании определите 5 самых дорогих товаров в таблице products. Но теперь колонки `name и price` переименуйте соответственно в `product_name и product_price`.

Поля в результирующей таблице: `product_name, product_price`

```sql

SELECT name as product_name,
       price as product_price
FROM   products
ORDER BY price desc limit 5

```

#### [Задача 6](https://lab.karpov.courses/learning/152/module/1762/lesson/18484/53190/250923)

<details>

В SQL-запросах к колонкам таблиц можно применять разные функции — так же, как, например, в Excel.

В общем виде синтаксис функций выглядит примерно так:

```sql
SELECT function(a, b, c, ...)
FROM table
```

Вместо function указывается название функции, а в скобках — её аргументы. В качестве аргументов могут выступать как колонки со значениями, так и отдельные значения. В зависимости от функции количество необходимых для её работы аргументов может отличаться.

Если вы когда-нибудь работали в Excel, то вам наверняка знакомы разные функции вроде `SUM, MIN, MAX` и т.д., которые производят некоторые вычисления по столбцам. В SQL они называются агрегирующими функциями, и подробно о них мы будет говорить в последующих уроках.

Сейчас же в качестве примера рассмотрим функцию `LENGTH`. Она выполняет довольно простую задачу — подсчитывает количество символов в поданном ей на вход значении текстового типа (текстовый тип данных ещё часто называют строкой — от англ. «string»). Иными словами, функция LENGTH измеряет длину некоторой строки в символах:

```sql
SELECT LENGTH('karpov.courses')

Результат:
14
```

Функция `LENGTH` также может применяться ко всему столбцу. В таком случае длина в символах будет посчитана для каждого значения в столбце. Соответствующий запрос будет выглядеть так:

```sql
SELECT LENGTH(column) AS column_length
FROM table
```
</details>

`Задание:`

Используя операторы `SELECT, FROM, ORDER BY и LIMIT`, а также функцию `LENGTH`, определите товар с самым длинным названием в таблице `products`. Выведите его наименование, длину наименования в символах, а также цену этого товара. Колонку с длиной наименования в символах назовите `name_length`.

Поля в результирующей таблице: `name, name_length, price`

`Пояснение`

Обратите внимание, что в этой задаче вам придётся сортировать результирующую таблицу по расчётной колонке `name_length`, которой изначально не было в таблице `products`.

Такая сортировка по новым колонкам возможна, поскольку это согласуется с порядком выполнения операторов в запросе: сначала выполняется выбор колонок и все преобразования над ними в операторе `SELECT` — и только потом производится сортировка по указанным в `ORDER BY` столбцам. То есть к моменту сортировки все расчётные поля уже существуют, а значит, их можно указывать в `ORDER BY`.

Также обратите внимание, что мы дважды указываем колонку name в операторе `SELECT`: в первый раз просто обращаемся к ней по имени, а во второй — используем её в качестве аргумента функции `LENGTH`. В этом случае тоже нет никаких противоречий — мы можем выбирать колонку столько раз, сколько необходимо, причём для этого даже необязательно присваивать этим колонкам разные алиасы (база данных сама переименует дубликат колонки).


```sql

SELECT name,
       length(name) as name_length,
       price
FROM   products
ORDER BY name_length desc limit 1

```
